<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Boolean Guards - Autofill Extension</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .form-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1, h2 {
            color: #333;
        }
        .form-group {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        .radio-label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        .radio-label input {
            width: auto;
            margin-right: 8px;
        }
        .test-section {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 30px;
        }
        .expected {
            background: #fff3e0;
            padding: 10px;
            border-left: 4px solid #ff9800;
            margin-top: 10px;
            font-size: 14px;
        }
        .filled {
            background-color: #d4edda !important;
            border-color: #28a745 !important;
        }
        .result-box {
            padding: 15px;
            margin-top: 20px;
            border-radius: 4px;
            display: none;
        }
        .result-box.success {
            background: #d4edda;
            border: 1px solid #28a745;
            display: block;
        }
        .result-box.fail {
            background: #f8d7da;
            border: 1px solid #dc3545;
            display: block;
        }
    </style>
</head>
<body>
    <h1>Test Boolean Guards for Work Authorization & Sponsorship</h1>
    
    <div class="test-section">
        <h3>Test Instructions:</h3>
        <ol>
            <li>Set up your profile in the extension with:
                <ul>
                    <li><strong>US Work Eligible:</strong> "Yes"</li>
                    <li><strong>Sponsorship Required:</strong> "No"</li>
                    <li><strong>Pronouns:</strong> "She/Her/Hers" (or any pronoun value)</li>
                </ul>
            </li>
            <li>Click "Autofill Forms" in the extension popup</li>
            <li>Verify that:
                <ul>
                    <li>Work authorization fields are filled with "Yes"</li>
                    <li>Sponsorship fields are filled with "No"</li>
                    <li><strong>Pronoun values DO NOT appear in work authorization or sponsorship fields</strong></li>
                    <li>Pronoun fields remain empty (since this test doesn't include a pronoun field)</li>
                </ul>
            </li>
        </ol>
    </div>

    <form id="testForm">
        <!-- Test Case 1: Work Authorization Select -->
        <div class="form-container">
            <h2>Test 1: Work Authorization Dropdown (Should fill with "Yes")</h2>
            <div class="form-group">
                <label for="work_auth_1">Are you legally authorized to work in the United States? *</label>
                <select id="work_auth_1" name="us_work_eligible">
                    <option value="">Please select</option>
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                    <option value="she/her">She/Her</option>
                    <option value="he/him">He/Him</option>
                    <option value="they/them">They/Them</option>
                </select>
                <div class="expected">
                    <strong>Expected:</strong> Should be filled with "Yes" only. Pronoun options (She/Her, He/Him, They/Them) should NEVER be selected.
                </div>
            </div>
        </div>

        <!-- Test Case 2: Work Authorization Radios -->
        <div class="form-container">
            <h2>Test 2: Work Authorization Radio Buttons (Should fill "Yes")</h2>
            <div class="form-group">
                <label>Are you authorized to work in the US without sponsorship?</label>
                <div class="radio-group">
                    <label class="radio-label">
                        <input type="radio" name="work_auth_radio" value="yes">
                        <span>Yes</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="work_auth_radio" value="no">
                        <span>No</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="work_auth_radio" value="she/her">
                        <span>She/Her</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="work_auth_radio" value="he/him">
                        <span>He/Him</span>
                    </label>
                </div>
                <div class="expected">
                    <strong>Expected:</strong> "Yes" radio should be selected. Pronoun radios should NEVER be selected.
                </div>
            </div>
        </div>

        <!-- Test Case 3: Sponsorship Select -->
        <div class="form-container">
            <h2>Test 3: Sponsorship Dropdown (Should fill with "No")</h2>
            <div class="form-group">
                <label for="sponsorship_1">Will you now or in the future require sponsorship for employment visa status?</label>
                <select id="sponsorship_1" name="sponsorship_required">
                    <option value="">Please select</option>
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                    <option value="she/her/hers">She/Her/Hers</option>
                    <option value="he/him/his">He/Him/His</option>
                </select>
                <div class="expected">
                    <strong>Expected:</strong> Should be filled with "No" only. Pronoun options should NEVER be selected.
                </div>
            </div>
        </div>

        <!-- Test Case 4: Sponsorship Radios -->
        <div class="form-container">
            <h2>Test 4: Sponsorship Radio Buttons (Should fill "No")</h2>
            <div class="form-group">
                <label>Do you require visa sponsorship?</label>
                <div class="radio-group">
                    <label class="radio-label">
                        <input type="radio" name="sponsorship_radio" value="yes">
                        <span>Yes</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="sponsorship_radio" value="no">
                        <span>No</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="sponsorship_radio" value="they/them">
                        <span>They/Them</span>
                    </label>
                </div>
                <div class="expected">
                    <strong>Expected:</strong> "No" radio should be selected. Pronoun radio should NEVER be selected.
                </div>
            </div>
        </div>

        <!-- Test Case 5: Pronoun Field (Separate - Should NOT be filled by work auth logic) -->
        <div class="form-container">
            <h2>Test 5: Actual Pronoun Field (Should remain empty in this test)</h2>
            <div class="form-group">
                <label for="pronouns">Preferred Pronouns</label>
                <select id="pronouns" name="pronouns">
                    <option value="">Please select</option>
                    <option value="She/Her/Hers">She/Her/Hers</option>
                    <option value="He/Him/His">He/Him/His</option>
                    <option value="They/Them/Theirs">They/Them/Theirs</option>
                    <option value="Other">Other</option>
                </select>
                <div class="expected">
                    <strong>Expected:</strong> This field should remain empty in this test. This ensures pronouns don't leak into work authorization fields.
                </div>
            </div>
        </div>

        <!-- Test Case 6: Multiple Similar Fields (Only highest-scoring should be filled) -->
        <div class="form-container">
            <h2>Test 6: Multiple Work Authorization Fields (Only best match filled)</h2>
            <div class="form-group">
                <label for="work_eligible_exact">Are you legally authorized to work in the United States?</label>
                <select id="work_eligible_exact" name="us_work_eligible">
                    <option value="">Select</option>
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                </select>
            </div>
            <div class="form-group">
                <label for="work_auth_vague">Can you work?</label>
                <select id="work_auth_vague" name="work">
                    <option value="">Select</option>
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                </select>
            </div>
            <div class="expected">
                <strong>Expected:</strong> Only the first field (exact match with "us_work_eligible") should be filled. The vague "work" field should remain empty due to lower score or threshold not met.
            </div>
        </div>
    </form>

    <div id="testResults" class="result-box"></div>

    <script>
        // Constants for test validation
        const PRONOUN_PATTERN = /she|he|they|her|him|them/i;
        const WORK_AUTH_PATTERN = /work.*auth|work.*eligible|us.*auth|us.*eligible|authorized/i;
        const SPONSORSHIP_PATTERN = /sponsor|visa/i;
        
        // Monitor form changes to highlight filled fields
        document.querySelectorAll('input, select').forEach(element => {
            element.addEventListener('change', function() {
                if (this.value) {
                    this.classList.add('filled');
                    console.log(`✓ Field filled: ${this.name || this.id} = ${this.value}`);
                    
                    // Check for pronoun values in work auth/sponsorship fields
                    const isPronounValue = PRONOUN_PATTERN.test(this.value);
                    const isWorkAuthField = WORK_AUTH_PATTERN.test(this.name || this.id);
                    const isSponsorshipField = SPONSORSHIP_PATTERN.test(this.name || this.id);
                    
                    if (isPronounValue && (isWorkAuthField || isSponsorshipField)) {
                        alert(`❌ ERROR: Pronoun value "${this.value}" was incorrectly filled into ${this.name || this.id}!`);
                        this.style.borderColor = 'red';
                        this.style.backgroundColor = '#ffebee';
                    }
                }
            });
            
            element.addEventListener('input', function() {
                if (this.value) {
                    this.classList.add('filled');
                }
            });
        });

        // Validation check after autofill - uses polling to detect completion
        function runValidation() {
            let passed = 0;
            let failed = 0;
            const results = [];
            
            // Test 1: Work auth select should be "yes"
            const workAuth1 = document.getElementById('work_auth_1');
            if (workAuth1.value === 'yes') {
                passed++;
                results.push('✓ Test 1 passed: Work authorization dropdown filled with "Yes"');
            } else if (PRONOUN_PATTERN.test(workAuth1.value)) {
                failed++;
                results.push('✗ Test 1 FAILED: Work authorization filled with pronoun: ' + workAuth1.value);
            } else if (!workAuth1.value) {
                results.push('⚠ Test 1 skipped: Work authorization not filled (check profile setup)');
            }
            
            // Test 2: Work auth radios should select "yes"
            const workAuthRadio = document.querySelector('input[name="work_auth_radio"]:checked');
            if (workAuthRadio && workAuthRadio.value === 'yes') {
                passed++;
                results.push('✓ Test 2 passed: Work authorization radio "Yes" selected');
            } else if (workAuthRadio && PRONOUN_PATTERN.test(workAuthRadio.value)) {
                failed++;
                results.push('✗ Test 2 FAILED: Work authorization radio filled with pronoun: ' + workAuthRadio.value);
            } else {
                results.push('⚠ Test 2 skipped: No work authorization radio selected');
            }
            
            // Test 3: Sponsorship select should be "no"
            const sponsorship1 = document.getElementById('sponsorship_1');
            if (sponsorship1.value === 'no') {
                passed++;
                results.push('✓ Test 3 passed: Sponsorship dropdown filled with "No"');
            } else if (PRONOUN_PATTERN.test(sponsorship1.value)) {
                failed++;
                results.push('✗ Test 3 FAILED: Sponsorship filled with pronoun: ' + sponsorship1.value);
            } else if (!sponsorship1.value) {
                results.push('⚠ Test 3 skipped: Sponsorship not filled (check profile setup)');
            }
            
            // Test 4: Sponsorship radios should select "no"
            const sponsorshipRadio = document.querySelector('input[name="sponsorship_radio"]:checked');
            if (sponsorshipRadio && sponsorshipRadio.value === 'no') {
                passed++;
                results.push('✓ Test 4 passed: Sponsorship radio "No" selected');
            } else if (sponsorshipRadio && PRONOUN_PATTERN.test(sponsorshipRadio.value)) {
                failed++;
                results.push('✗ Test 4 FAILED: Sponsorship radio filled with pronoun: ' + sponsorshipRadio.value);
            } else {
                results.push('⚠ Test 4 skipped: No sponsorship radio selected');
            }
            
            // Test 5: Pronoun field should remain empty
            const pronounField = document.getElementById('pronouns');
            if (!pronounField.value) {
                passed++;
                results.push('✓ Test 5 passed: Pronoun field remained empty');
            }
            
            // Display results
            const resultsBox = document.getElementById('testResults');
            resultsBox.innerHTML = '<h3>Test Results:</h3>' + 
                '<p><strong>Passed:</strong> ' + passed + ' | <strong>Failed:</strong> ' + failed + '</p>' +
                '<ul>' + results.map(r => '<li>' + r + '</li>').join('') + '</ul>';
            resultsBox.className = 'result-box ' + (failed > 0 ? 'fail' : 'success');
        }
        
        // Poll for autofill completion - runs validation after a delay
        // In a real-world scenario, the extension would trigger a custom event
        setTimeout(runValidation, 3000); // 3 seconds should be sufficient for autofill
    </script>
</body>
</html>
